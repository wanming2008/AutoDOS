# AutoDOS

## 项目简介

AutoDOS是一个基于STM32H7双核架构的ADAS（高级驾驶辅助系统）安全测试工具固件。本项目整合了CAN中间人、超声波雷达攻击和毫米波雷达攻击功能，为ADAS安全研究提供完整的硬件解决方案。

## 功能特性

### 1. CAN中间人功能
- 双向转发FDCAN1和FDCAN2之间的CAN消息
- 支持实时修改CAN消息ID和数据
- 支持7个独立的篡改规则配置
- 支持CAN 2.0和CANFD协议

### 2. 超声波雷达攻击
- **干扰模式**: 持续输出48kHz超声波信号，干扰超声波雷达
- **欺骗模式**: 检测雷达发射信号，延迟发射虚假回波，实现距离欺骗
- 可配置欺骗延迟距离

### 3. 毫米波雷达攻击
- 识别毫米波雷达CAN消息
- 修改距离、目标数量等关键数据
- 通过CAN中间人功能转发修改后的消息

### 4. DSI3总线控制
- 通过SPI控制DSI3转换芯片
- 支持DSI3总线嗅探、欺骗和干扰
- 支持最多4个DSI3传感器通道
- 实现超声波雷达DSI3协议攻击

### 5. TPMS胎压监测系统攻击
- 使用TI CC1101芯片进行433MHz信号模拟
- 支持胎压欺骗（低胎压、高胎压、爆胎）
- 支持4个轮胎位置
- 支持TPMS信号嗅探

## 硬件平台

- **主控芯片**: STM32H745ZITx（双核：Cortex-M7 + Cortex-M4）
- **工作频率**: 240MHz（CM7核心）
- **工作电压**: 3.3V

## 项目结构

```
AutoDOS_Integrated/
├── CM7/                    # Cortex-M7核心代码
│   ├── Inc/               # 头文件
│   │   ├── main.h
│   │   ├── uss_attack.h      # 超声波攻击模块
│   │   ├── mmwave_attack.h   # 毫米波攻击模块
│   │   ├── dsi3_control.h    # DSI3控制模块
│   │   └── tpms_cc1101.h     # TPMS攻击模块
│   └── Src/                  # 源文件
│       ├── main.c            # 主程序
│       ├── uss_attack.c      # 超声波攻击实现
│       ├── mmwave_attack.c   # 毫米波攻击实现
│       ├── dsi3_control.c    # DSI3控制实现
│       └── tpms_cc1101.c     # TPMS攻击实现
├── CM4/                   # Cortex-M4核心代码（预留）
├── 硬件接口说明.md        # 硬件接口详细说明
├── 固件功能和使用说明.md  # 固件功能和使用指南
└── README.md              # 本文件
```

## 快速开始

### 1. 硬件准备

参考 `硬件接口说明.md` 进行硬件连接：
- CAN总线接口（FDCAN1和FDCAN2）
- 超声波换能器和驱动电路
- 回波检测电路
- USB接口

### 2. 软件编译

使用STM32CubeIDE或Keil MDK打开项目：
1. 配置项目路径和工具链
2. 编译CM7和CM4核心代码
3. 下载固件到目标板

### 3. 使用说明

参考 `固件功能和使用说明.md` 了解：
- 功能详解
- 配置方法
- 使用示例
- 通信协议

## 硬件接口总结

| 接口类型 | 数量 | 功能 |
|---------|------|------|
| CAN总线 | 2 | CAN中间人转发 |
| 超声波PWM | 2 | 48kHz超声波输出 |
| ADC输入 | 1 | 回波信号检测 |
| USB | 1 | 上位机通信 |
| SPI | 2 | SPI6(DSI3), SPI3(CC1101) |
| SPI CS | 2 | DSI3和CC1101片选 |
| CC1101 GDO0 | 1 | 数据包检测 |
| LED指示 | 3 | 状态指示 |
| GPIO | 2 | 通用IO |

**总计**: 17个主要硬件接口

## 主要功能模块

### CAN中间人模块
- 双向消息转发
- 实时消息修改
- 7个独立篡改规则

### 超声波攻击模块
- PWM输出（48kHz）
- ADC回波检测
- 干扰和欺骗模式

### 毫米波雷达攻击模块
- CAN消息识别
- 数据修改
- 自动转发

## 通信接口

- **USB虚拟串口**: 与上位机通信，接收命令和发送数据
- **SPI接口**: 备用通信接口

## 文档

- [硬件接口说明.md](硬件接口说明.md) - 详细的硬件接口说明
- [固件功能和使用说明.md](固件功能和使用说明.md) - 完整的功能和使用指南（包含DSI3和TPMS）
- [配置说明.md](配置说明.md) - HAL模块和外设配置说明
- [超声波发送硬件说明.md](超声波发送硬件说明.md) - 超声波发送硬件原理
- [项目检查报告.md](项目检查报告.md) - 项目结构和代码逻辑检查报告
- [DSI3和TPMS功能说明.md](DSI3和TPMS功能说明.md) - DSI3和TPMS功能详细说明

## 安全警告

⚠️ **重要**: 本固件仅用于安全研究和测试目的。不得用于非法攻击真实车辆。测试应在受控环境中进行，并遵守当地法律法规。

## 版本信息

- **版本**: 1.0.0
- **发布日期**: 2023
- **支持平台**: STM32H745ZITx

## 开发环境

- STM32CubeIDE 1.x
- Keil MDK-ARM 5.x
- STM32CubeMX（用于配置）

## 依赖项

- STM32H7 HAL库
- USB Device库（CDC类）
- STM32H7 BSP库

## 许可证

本项目基于AutoDOS开源项目，遵循相应的开源许可证。

## 贡献

欢迎提交Issue和Pull Request。

## 联系方式

如有问题，请参考文档或提交Issue。

---

**注意**: 本项目整合了以下原始项目：
- ST_CAN_0.0: CAN中间人固件
- uss_attack_program: 超声波攻击程序

## 新增功能

### DSI3总线控制
- 支持SPI转DSI3芯片控制
- 实现DSI3总线嗅探、欺骗和干扰
- 支持4个传感器通道同步控制

### TPMS胎压攻击
- 使用TI CC1101进行433MHz信号模拟
- 支持多种胎压攻击场景
- 支持传感器ID配置和信号嗅探

