# 超声波发送硬件说明

## 1. 发送PWM信号的硬件

### STM32定时器（TIM1）
- **硬件**: STM32H7的TIM1定时器
- **功能**: 产生48kHz的PWM信号
- **输出引脚**:
  - **TIM1_CH1**: PA8（正极输出）
  - **TIM1_CH2**: PA9（负极输出，互补）
- **输出方式**: 互补PWM（推挽输出）
- **频率**: 48kHz
- **占空比**: 50%

### 工作原理
```
STM32 TIM1定时器 
    ↓ (产生48kHz PWM信号)
PA8 (TIM1_CH1) ──┐
                 ├──→ 驱动电路 ──→ 超声波换能器 ──→ 发射48kHz超声波
PA9 (TIM1_CH2) ──┘ (互补PWM，推挽输出)
```

## 2. 超声波换能器（Transducer）

### 什么是超声波换能器？
- **定义**: 将电信号转换为超声波信号的器件
- **类型**: 压电陶瓷超声波换能器
- **工作频率**: 40-48kHz（本系统使用48kHz）
- **功能**: 
  - 接收PWM电信号
  - 振动产生超声波
  - 发射到空气中

### 换能器连接
```
TIM1_CH1 (PA8) ──→ 换能器正极
TIM1_CH2 (PA9) ──→ 换能器负极
```

## 3. 驱动电路

### 为什么需要驱动电路？
STM32的GPIO输出电流有限（通常<25mA），而超声波换能器需要较大的驱动功率，因此需要驱动电路。

### 驱动电路方案

#### 方案1: H桥驱动（推荐）
```
TIM1_CH1 ──→ H桥驱动芯片（如DRV8833）──→ 换能器
TIM1_CH2 ──→ H桥驱动芯片
```
- **优点**: 功率大，效率高，支持双向驱动
- **适用**: 大功率超声波换能器

#### 方案2: 推挽放大器
```
TIM1_CH1 ──→ 推挽放大器 ──→ 换能器
TIM1_CH2 ──→ 推挽放大器
```
- **优点**: 电路简单
- **适用**: 中小功率换能器

#### 方案3: 专用超声波驱动芯片
- 使用专用的超声波驱动IC
- 集成度高，性能好

## 4. 完整信号链路

```
STM32 TIM1定时器
    ↓
产生48kHz PWM信号（互补输出）
    ↓
PA8 (TIM1_CH1) ──┐
                 ├──→ 驱动电路（H桥/推挽放大器）
PA9 (TIM1_CH2) ──┘
    ↓
驱动电路放大PWM信号
    ↓
超声波换能器（压电陶瓷）
    ↓
换能器振动产生48kHz超声波
    ↓
超声波在空气中传播
```

## 5. 两种工作模式

### 模式1: 干扰模式（Jamming）
```
TIM1持续输出48kHz PWM
    ↓
驱动电路持续驱动
    ↓
换能器持续发射48kHz超声波
    ↓
干扰车辆超声波雷达的正常工作
```

### 模式2: 欺骗模式（Spoof）
```
1. ADC检测车辆雷达发射的超声波（通过回波检测电路）
2. 检测到触发信号后
3. 延迟一定时间（对应虚假距离）
4. TIM1输出60个周期的48kHz PWM脉冲
5. 驱动电路驱动换能器
6. 换能器发射虚假回波
7. 车辆雷达接收到虚假回波，误判距离
```

## 6. 硬件组件总结

| 组件 | 功能 | 位置 |
|------|------|------|
| **STM32 TIM1** | 产生48kHz PWM信号 | STM32H7芯片内部 |
| **PA8/PA9** | PWM输出引脚 | STM32 GPIO |
| **驱动电路** | 放大PWM信号功率 | 外部电路板 |
| **超声波换能器** | 将电信号转换为超声波 | 外部器件 |

## 7. 关键参数

### PWM参数
- **频率**: 48kHz（与超声波雷达工作频率一致）
- **占空比**: 50%
- **输出方式**: 互补PWM（推挽）
- **电压**: 3.3V（STM32输出）

### 驱动电路参数
- **输入**: 3.3V PWM信号
- **输出**: 根据换能器需求（通常5-12V）
- **功率**: 根据换能器规格（通常几瓦到几十瓦）

### 换能器参数
- **工作频率**: 48kHz
- **阻抗**: 通常几百到几千欧姆
- **功率**: 根据应用需求选择

## 8. 注意事项

1. **驱动电路必须**: 
   - 能够提供足够的驱动功率
   - 支持48kHz频率响应
   - 具有良好的线性度

2. **换能器选择**:
   - 工作频率必须匹配48kHz
   - 功率要满足应用需求
   - 方向性要符合应用场景

3. **PCB布局**:
   - PWM信号线要尽量短
   - 避免干扰
   - 驱动电路要靠近换能器

4. **电源**:
   - 驱动电路需要独立电源
   - 确保电源稳定
   - 注意功率消耗

## 9. 总结

**发送PWM的是**: STM32的TIM1定时器（硬件定时器）

**发送超声波的是**: 超声波换能器（压电陶瓷器件）

**中间环节**: 驱动电路（放大PWM信号，驱动换能器）

整个系统是：**STM32定时器 → 驱动电路 → 超声波换能器 → 超声波**

